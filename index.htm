<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Te Amo ‚ù§Ô∏è</title>
<style>
 html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    width: 100%;
    height: 100%;
    background: #000;
 }

/* El canvas siempre ocupa exactamente la pantalla,
   sin estirarse raro en otros editores */
canvas {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: block;
}

/* --- CONTENEDOR INTRO --- */
#intro {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle, #ff7ab8 0%, #c01c5a 80%);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
  overflow: hidden;
}

/* capa con corazones detr√°s del bot√≥n */
#fondoCorazones {
  position: absolute;
  inset: 0;
  z-index: 1;
  overflow: hidden;
}

/* corazones flotando */
.heartFloat {
  position: absolute;
  font-size: clamp(22px, 6vmin, 40px);
  animation: float 8s linear infinite;
  opacity: 0.8;
  bottom: -8vh;
}

@keyframes float {
  0% {
    transform: translateY(-15vh) scale(1.8);
    opacity: 0;
  }
  20% { opacity: 1; }
  100% {
    transform: translateY(-100vh) scale(2.7);
    opacity: 0;
  }
}

/* Bot√≥n centrado y responsive */
#startBtn {
  padding: 0.9em 2.2em;
  font-size: clamp(20px, 4.5vw, 23px);
  font-weight: bold;
  color: white;
  background: #000000ff;
  border: none;
  border-radius: 18px;
  cursor: pointer;
  z-index: 5;
  position: relative;
  box-shadow: 0 0 25px rgba(255,0,80,0.6);
  animation: latido 1.3s infinite ease-in-out;
  max-width: 85%;
  text-align: center;
}

@keyframes latido {
  0% { transform: scale(1); }
  35% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* üéÜ FIREWORKS CANVAS (ENCIMA DE TODO) */
#fireworksCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 99999;
}
</style>
</head>

<body>

<!-- INTRO CON BOT√ìN Y FONDO DE CORAZONES -->
<div id="intro">
  <div id="fondoCorazones"></div>
  <button id="startBtn">üíñ Para la Reina de mi Coraz√≥n üíñ</button>
</div>

<!-- CANVAS PRINCIPAL -->
<canvas id="canvas"></canvas>

<!-- üéÜ CANVAS DE FUEGOS ARTIFICIALES -->
<canvas id="fireworksCanvas"></canvas>

<script>
// ---------------- GENERAR CORAZONES DETR√ÅS ----------------
const fondo = document.getElementById("fondoCorazones");

for (let i = 0; i < 25; i++) {
  let h = document.createElement("div");
  h.className = "heartFloat";
  h.textContent = "‚ù§Ô∏è";
  h.style.left = Math.random() * 100 + "vw";
  h.style.animationDelay = (Math.random() * 5) + "s";
  fondo.appendChild(h);
}

// ---------------- INICIO DE ANIMACI√ìN ----------------
document.getElementById("startBtn").addEventListener("click", () => {
  intro.style.opacity = "0";
  setTimeout(()=> intro.style.display = "none", 10);
  startAnimation();
});

// =========================================================
// üéÜ SISTEMA DE FUEGOS ARTIFICIALES
// =========================================================
const fwCanvas = document.getElementById("fireworksCanvas");
const fwCtx = fwCanvas.getContext("2d");

function resizeFW() {
  fwCanvas.width = window.innerWidth;
  fwCanvas.height = window.innerHeight;
}
resizeFW();
window.addEventListener("resize", resizeFW);

let fireworks = [];

function createFirework() {
  const x = Math.random() * fwCanvas.width;
  const y = Math.random() * fwCanvas.height * 0.4 + fwCanvas.height * 0.2;

  const colors = [
    "hsl(330,100%,60%)",
    "hsl(350,100%,65%)",
    "hsl(300,100%,70%)",
    "hsl(10,100%,70%)"
  ];

  for (let i = 0; i < 45; i++) {
    fireworks.push({
      x,
      y,
      angle: Math.random() * Math.PI * 2,
      speed: Math.random() * 1 + 0.9,
      radius: Math.random() * 3 + 2,
      color: colors[Math.floor(Math.random() * colors.length)],
      alpha: 1,
      decay: Math.random() * 0.004 + 0.002

    });
  }
}

function updateFireworks() {
  fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);

  fireworks = fireworks.filter(f => f.alpha > 0);

  fireworks.forEach(f => {
    f.x += Math.cos(f.angle) * f.speed;
    f.y += Math.sin(f.angle) * f.speed;
    f.alpha -= f.decay;

    fwCtx.beginPath();
    fwCtx.globalAlpha = f.alpha;
    fwCtx.fillStyle = f.color;
    fwCtx.shadowBlur = 15;
    fwCtx.shadowColor = f.color;
    fwCtx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
    fwCtx.fill();
  });

  requestAnimationFrame(updateFireworks);
}
updateFireworks();

function launchCelebration() {
  // lanzar varios fuegos de una tanda
  for (let i = 0; i < 6; i++) {
    setTimeout(createFirework, i * 250);
  }

  // repetir este efecto infinitamente
  setTimeout(launchCelebration, 1200); // puedes ajustar el tiempo
}

// =========================================================
// üîª AQU√ç EMPIEZA TU ANIMACI√ìN ORIGINAL (NO CAMBIADA)
// =========================================================

function startAnimation() {

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let cx, cy, scale;
function resize() {
  canvas.width = window.innerWidth; 
  canvas.height = window.innerHeight;
  cx = canvas.width / 2;
  cy = canvas.height / 2;
  scale = Math.min(canvas.width, canvas.height) / 50; 
}
window.addEventListener("resize", resize);
resize();

// HEART -----------------------
function heartPoint(t, s = scale) {
  const x = s * 16 * Math.pow(Math.sin(t), 3); 
  const y =
    -s *
    (13 * Math.cos(t) -
     5 * Math.cos(2 * t) -
     2 * Math.cos(3 * t) -
     Math.cos(4 * t));
  return { x, y };
}

let t = 0;
let heartPoints = [];
let pulse = 0;
let phase = "heart"; 

// TEXT PARTICLES ---------------------
let textPoints = [];
let textParticles = [];
let textStarted = false;
let petalsActive = false;
let fireworksStarted = false; // ‚≠ê NUEVA BANDERA

function generateTextPoints() {
  const off = document.createElement("canvas");
  off.width = 300;
  off.height = 120;
  const octx = off.getContext("2d");

  octx.fillStyle = "white";
  octx.font = "bold 80px Arial";
  octx.textAlign = "center";
  octx.textBaseline = "middle";
  octx.fillText("TE AMO", 150, 60);

  const data = octx.getImageData(0, 0, 300, 120).data;
  const step = 4;
  let pts = [];

  for (let y = 0; y < 120; y += step) {
    for (let x = 0; x < 300; x += step) {
      const idx = (y * 300 + x) * 4 + 3;
      if (data[idx] > 128) pts.push({ x: x - 150, y: y - 60 });
    }
  }

  const textScale = scale * 0.15;
  textPoints = pts.map((p) => ({
    x: p.x * textScale,
    y: p.y * textScale - scale * 0.5,
  }));
}

function initTextParticles() {
  if (textStarted) return;
  textStarted = true;
  generateTextPoints();

  textParticles = textPoints.map((p) => {
    const angle = Math.random() * Math.PI * 2;
    const sp = Math.random() * 1.5 + 0.5;

    return {
      x: 0,
      y: 0,
      tx: p.x,
      ty: p.y,
      vx: Math.cos(angle) * sp,
      vy: Math.sin(angle) * sp,
      arrived: false,
      life: 0,
      hue: 330 + Math.random() * 40,
    };
  });
}

// FALLING PETALS ------------------------
let falling = [];

function spawnFalling() {
  const size = Math.random() * 20 + 10;
  const isHeart = Math.random() < 0.5;
 
  falling.push({
    x: Math.random() * canvas.width,
    y: -20,
    size,
    speed: Math.random() * 1,

    drift: Math.random() * 1 - 0.5,
    rotation: Math.random() * Math.PI * 2,
    rotSpeed: Math.random() * 0.02 - 0.01,
    type: isHeart ? "heart" : "petal",
    hue: isHeart ? 340 + Math.random()*20 : 330 + Math.random()*30
  });
}

function drawFalling() {
  if (Math.random() < 0.3) spawnFalling();

  falling = falling.filter(f => f.y < canvas.height + 60);

  for (let f of falling) {
    f.y += f.speed;
    f.x += f.drift;
    f.rotation += f.rotSpeed;

    ctx.save();
    ctx.translate(f.x, f.y);
    ctx.rotate(f.rotation);

    if (f.type === "heart") {
      ctx.fillStyle = `hsl(${f.hue},100%,60%)`;
      ctx.beginPath();
      const s = f.size;
      ctx.moveTo(0, -s/2);
      ctx.bezierCurveTo(s/2, -s, s, -s/4, 0, s);
      ctx.bezierCurveTo(-s, -s/4, -s/2, -s, 0, -s/2);
      ctx.fill();
    } else {
      ctx.fillStyle = `hsl(${f.hue},100%,70%)`;
      ctx.beginPath();
      ctx.ellipse(0,0,f.size*0.6,f.size,0,0,Math.PI*2);
      ctx.fill();
    }

    ctx.restore();
  }
}

// DRAW LOOP --------------------------
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(1 + 0.015 * Math.sin(pulse * 0.1), 1 + 0.015 * Math.sin(pulse * 0.1));

  // HEART DRAW
  if (phase === "heart") {
    const { x, y } = heartPoint(t);
    heartPoints.push({ x, y });

    ctx.beginPath();
    ctx.strokeStyle = "rgba(255,80,150,0.4)";
    ctx.lineWidth = 0.8;
    ctx.moveTo(0, 0);
    ctx.lineTo(x, y);
    ctx.stroke();

    ctx.fillStyle = "white";
    ctx.shadowColor = "hotpink";
    ctx.shadowBlur = 12;
    ctx.beginPath();
    ctx.arc(x, y, 2.2, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.strokeStyle = "rgba(255,105,180,1)";
    ctx.lineWidth = 2;
    for (let i = 0; i < heartPoints.length - 1; i++) {
      ctx.moveTo(heartPoints[i].x, heartPoints[i].y);
      ctx.lineTo(heartPoints[i + 1].x, heartPoints[i + 1].y);
    }
    ctx.stroke();

    t += 0.03;
    if (t >= Math.PI * 2 + 0.2) {
      phase = "text";
      initTextParticles();
    }
  }

  // TEXT PARTICLES
  else if (phase === "text") {
    ctx.beginPath();
    ctx.strokeStyle = "rgba(255,105,180,1)";
    ctx.lineWidth = 2;
    for (let i = 0; i < heartPoints.length - 1; i++) {
      ctx.moveTo(heartPoints[i].x, heartPoints[i].y);
      ctx.lineTo(heartPoints[i + 1].x, heartPoints[i + 1].y);
    }
    ctx.stroke();

    let arrivedAll = true;

    for (let p of textParticles) {
      if (!p.arrived) {
        arrivedAll = false;

        // MUCH√çSIMA m√°s atracci√≥n (s√≠ llegan)
        p.x += (p.tx - p.x) * 0.12 + p.vx * 0.05;
        p.y += (p.ty - p.y) * 0.12 + p.vy * 0.05;

        // margen de llegada m√°s amplio
        if (Math.hypot(p.x - p.tx, p.y - p.ty) < scale * 1.5)
            p.arrived = true;

      } else {
        p.life++;
      }

      ctx.beginPath();
      ctx.globalAlpha = 1;
      ctx.shadowColor = `hsl(${p.hue},100%,70%)`;
      ctx.shadowBlur = 6;
      ctx.fillStyle = `hsl(${p.hue},100%,${60 + 25 * Math.sin(p.life * 0.15)}%)`;
      ctx.arc(p.x, p.y, 3.1, 0, Math.PI * 2);
      ctx.fill();
    }

    // ‚≠ê ACTIVACI√ìN FINAL CORRECTA
    if (arrivedAll) {

        // activar lluvia de p√©talos
        // (si quieres reactivarlo: petalsActive = true;)

        // activar fuegos artificiales SOLO una vez
        if (!fireworksStarted) { 
            fireworksStarted = true;
            launchCelebration(); // üéÜ FUEGOS ARTIFICIALES
        }
    }
  }

  ctx.restore();

  if (petalsActive) drawFalling();

  pulse++;
  requestAnimationFrame(draw);
}

draw();

} // FIN START ANIMATION

</script>
</body>
</html>
